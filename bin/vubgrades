#!/usr/bin/env python2

import requests
from bs4 import BeautifulSoup

def get_grades(netid, password):
    s = requests.session()
    s.get("http://student.cumulus.vub.ac.be/psp/CALIPROD/signon.html?cmd=login")
    s.post("https://student.cumulus.vub.ac.be/psp/CALIPROD/EMPLOYEE/HRMS/?cmd=login&languageCd=ENG", data={'timezonOffset': -120, 'userid': netid, 'pwd': password})
    r = s.get("https://student.cumulus.vub.ac.be/psc/CALIPROD/EMPLOYEE/HRMS/c/SA_LEARNER_SERVICES.SSR_SSENRL_GRADE.GBL?Page=SSR_SSENRL_GRADE&Action=A&TargetFrameName=None")

    soup = BeautifulSoup(r.content)
    table = soup.select('.PSLEVEL1GRID')[0]
    lines = table.select('tr')
    heading = [x.text for x in lines[0].select('th')]
    return [dict(zip(heading, [y.text.strip() for y in x.select('td')])) for x in lines[1:]]

if __name__ == "__main__":
    from vubnotes_local_config import NETID, PASSWORD
    grades = get_grades(NETID, PASSWORD)
    by_course = {x['Description']: x['Cijfer'] for x in grades}
    
    for c in sorted(by_course.keys()):
        print "\033[1m%40s\033[0m: %s" % (c, by_course[c])
